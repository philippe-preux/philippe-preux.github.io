<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Brad's sweet home</title>
  <link href="https://philippe-preux.github.io/css/ma.css" 
	rel="stylesheet" type="text/css" media="all" />
  <link rel="shortcut icon" type="image/x-icon" 
	href="https://philippe-preux.github.io/img/site.ico" />
</head>


<style>
  .aligncenter {
      text-align: center;
  }
</style>

<body>
  <div class="tpR">

  <h1></h1>
  
  <p>

    Dans ce TP, on continue notre exploration de notions et techniques de base pour la science des données. On va notamment manipuler des fichiers de données beaucoup plus gros que précédemment et réaliser des tâches de régression.

    <br/>

    Tous les TPs précédents doivent impérativement avoir été faits.

    <br/>
    <br/>

    À l'issue de ce TP, vous m'envoyez par email un compte-rendu (format <kbd>odt</kbd>) indiquant la réponse aux questions qui sont posées. Vous m'envoyez également un fichier python réalisant toutes les manipulations de ce TP&nbsp;: je dois pouvoir exécuter ce fichier en tapant <kbd>python3 nom-de-votre-fichier.py</kbd> et reproduire vos résultats. Cette exécution ne doit pas provoquer d'erreur de python. Remarque&nbsp;: un <i>notebook</i> ne convient pas.
    
  </p>

  <h2>Introduction</h2>
    
  <p>

    Brad vit en altitude, dans les montagnes du Colorado (il y fait froid assez tôt dans l’automne et tardivement au printemps). Il a aménagé une station de collecte des températures. Ainsi, quatre thermomètres électroniques mesurent la température dans son séjour, son bureau, son sous-sol et à l’extérieur de chez lui, toutes les 3 minutes. Ces thermomètres sont reliés à son ordinateur qui stocke chacune des mesures dans quatre fichiers, un fichier par thermomètre. On dispose de ces quatre fichiers qui contiennent plusieurs dizaines de milliers de mesures. Notre objectif est d’étudier les températures ainsi mesurées. On sait également que le thermostat de Brad est réglé à 21°C pendant la journée, à 16°C pendant la nuit.

    <br/>
    <br/>

    Ces 4 fichiers de données sont disponibles à ces 4 urls&nbsp;:

    <ul>
      <li><kbd>https://philippe-preux.github.io/ensg/miashs/datasets/brad-basement</kbd></li>
      <li><kbd>https://philippe-preux.github.io/ensg/miashs/datasets/brad-lab</kbd></li>
      <li><kbd>https://philippe-preux.github.io/ensg/miashs/datasets/brad-livingroom</kbd></li>
      <li><kbd>https://philippe-preux.github.io/ensg/miashs/datasets/brad-outside</kbd></li>
    </ul>

  <p>

    Ces 4 fichiers ont le même format. 
    Dans votre navigateur, regardez l'un d'eux.
    Vous constatez qu'il ne s'agit pas de fichiers <kbd>csv</kbd> et qu'ils n'ont pas d'en-tête avec le nom des attributs.

    <br/>

    Dans ces 4 fichiers, les colonnes sont séparées par un espace. Dans l'ordre, les colonnes correspondent aux informations suivantes&nbsp;:

  </p>

  <ul>
    <li>l'année</li>
    <li>le mois</li>
    <li>le quantième</li>
    <li>heure</li>
    <li>minute</li>
    <li>seconde</li>
    <li>température</li>
  </ul>

  <p>

    Les lignes de chacun de ces fichiers sont ordonnées chronologiquement.

  </p>  
  
  <h2>Construction d'un tableau de données</h2>

  <p>

    On doit donc rassembler le contenu de ces 4 fichiers dans un tableau de données. Cette fusion doit s'effectuer en fonction de l'instant de la mesure.
    
    <br/>

    Pour cela, on commence par lire chacun de ces fichiers en le stockant dans un tableau de données.
    Pour lire ces fichiers qui ne sont pas au format <kbd>csv</kbd>, on utilisera la méthode <kbd>read_table()</kbd> de <kbd>pandas</kbd>. Regardez la documentation pour utiliser les bons arguments et lisez ces 4 fichiers dans 4 tableaux de données différents. Comme ces fichiers n'ont pas d'en-tête indiquant le nom des colonnes, donnez-leur un nom lors de la lecture. On trouve les mêmes 6 attributs indiquant la date et l'heure dans les 4 fichiers&nbsp;; donnez-leur le même nom (ce qui vous simplifiera les choses un peu plus tard). Vérifiez que la lecture s'est bien passée.
    
    <br/>

    Ensuite, on fusionne ces 4 tableaux de données pour n'en faire qu'un seul que nous dénommerons <kbd>brad</kbd>.
    Il faut utiliser la méthode <kbd>merge_ordered()</kbd> de <kbd>pandas</kbd> qui fusionne deux tableaux de données.
    N'hésitez pas à regarder la documentation concernant cette méthode.

    <br/>
    
    Une fois cela, fait, on peut détruire les 4 tableaux de données (commande python <kbd>del</kbd>) et ne conserver que <kbd>brad</kbd>.

    <br/>
    <br/>

    <b>À faire&nbsp;:</b> construisez ce tableau de données <kbd>brad</kbd>&nbsp;?

    <br/>
    <br/>

    Remarque&nbsp;: bien entendu, lorsqu'on réalise une telle opération de fusion, on vérifie que tout se passe bien. Puisque nous allons ensuite travailler uniquement sur le tableau de données <kbd>brad</kbd>, si celui-ci, pour une raison ou une autre, n'est pas construit correctement, tout ce que nous ferons par la suite sera faux.
    <br/>
    Il faut donc impérativement passer quelques instants à s'assurer que <kbd>brad</kbd> a été correctement construit.
    <br/>
    Pour vous aider, je vous indique ci-dessous les début et fin de <kbd>brad</kbd> correctement chargé&nbsp;:

  </p>

<pre>
>>> brad.head()
     an  mois   j   h  mn  temp_b  temp_l  temp_lr  temp_o
0  2003     7  25  16   4    24.0     NaN     29.8    27.5
1  2003     7  25  16   7    24.0     NaN     29.8    27.3
2  2003     7  25  16  10    24.0     NaN     29.8    27.3
3  2003     7  25  16  13    24.1     NaN     29.8    27.4
4  2003     7  25  16  16    24.1     NaN     29.8    27.8
>>> brad.tail()
          an  mois   j   h  mn  temp_b  temp_l  temp_lr  temp_o
169831  2004     7  16  15  16    21.7    22.9     22.8    16.8
169832  2004     7  16  15  19    21.7    22.9     22.8    16.9
169833  2004     7  16  15  22    21.7    22.9     22.8    16.8
169834  2004     7  16  15  25    21.7    22.9     22.8    16.8
169835  2004     7  16  15  28    21.7    22.9     22.8    16.4
</pre>

  <p>

    Obtenez-vous le même résultat&nbsp;? Est-ce que votre tableau de données semble correct&nbsp;?
    
    <br/>
    <br/>
    
    J'ai nommé les colonnes correspondant aux différentes températures <kbd>temp_b</kbd> pour le sous-sol (<i>basement</i>), <kbd>temp_l</kbd> pour la laboratoire (<i>lab</i>),  <kbd>temp_lr</kbd> pour le salon (<i>living-room</i>) et <kbd>temp_o</kbd> pour l'extérieur (<i>outside</i>).

    <br/>

    Notez bien les <kbd>NaN</kbd>&nbsp;: vous devez les avoir aussi pour ces lignes-là.

    <br/>
    <br/>
    
    <b>Question&nbsp;:</b> qu'est ce que ces <kbd>NaN</kbd>&nbsp;? Que font-ils là&nbsp;? Quel est leur signification&nbsp;?
    
  </p>
  

  <h2>Exploration visuelle du jeu de données</h2>

  <p>

    On peut commencer par quelques graphiques. Par exemple, représentons ces courbes de températures.

    <br/>

    Un premier essai pourrait vous donnez cela&nbsp;:
    
  </p>
  
  <p class="aligncenter">
      <img src="./1erEssai.png" width="400pt"/>
  </p>

  <p>

    où on ne voit rien&nbsp;!

    <br/>
    <br/>

    Réalisez le graphique ci-dessous qui montre les 4 courbes de températures séparées les unes des autres.
    
  </p>
  
  <p class="aligncenter">
      <img src="./courbesTemperature.png" width="400pt"/>
  </p>

  <p>

    C'est beaucoup mieux. Néanmoins, l'axe des abscisses est illisible. S'agissant de l'instant de mesure des températures, on préférerait y lire des dates, commme sur cette figure&nbsp;:

  </p>
  
  <p class="aligncenter">
      <img src="./courbesTemperatureAvecDates.png" width="400pt"/>
  </p>

  <p>

    C'est ce que nous allons faire mais cela nécessite quelques explications concernant les dates.
    
  </p>

  <h3>Dates</h3>

  <p>

    Les dates sont des objets complexes&nbsp;: ce ne sont pas des nombres, mais on peut faire des opérations entre dates&nbsp;: on peut soustraire une date à une autre et obtenir une durée. De même, on peut ajouter une durée (positive ou négative) à une date et obtenir une autre date. Par ailleurs, il y a un ordre total sur les dates.

    <br/>

    Concernant leur représentation, il en existe de multiples&nbsp: par exemple, en français, on peut écrire 13/10/23, 13/10/2023, 13 octobre 2023, 13 oct. 2023, ... On peut trouver des dates écrites sous des formats très différents dans les jeux de données, et c'est la même chose pour les heures&nbsp;: 14h 27 mn, 14h 27 mn 29 s, 14:27:29, ...

    <br/>

    Cette souplesse dans l'écriture nécessite des fonctions spécifiques permettant de les lire, les afficher et les manipuler.

    <br/>
    <br/>

    Nous allons transformer les 6 attributs indiquant les instants de mesure de températures en un attribut date. Nous commençons par quelques généralités sur les dates en python.

  </p>

  <h4>Les dates avec <kbd>pandas</kbd></h4>

  <p>

    La transformation des 6 attributs jour, mois, année, heure, minute, seconde en date se fait à l'aide de la méthode <kbd>to_datetime()</kbd> de <kbd>pandas</kbd>. Regardez la documentation de cette méthode (regardez les exemples) et ajoutez un attribut <kbd>date</kbd> au tableau de données <kbd>brad</kbd> contenant la date et l'heure de chaque ligne.

    <br/>
    <br/>
    
    Cela fait, l'attribut <kbd>date</kbd> contient un «&nbsp;tampon temporel&nbsp;» qui indique une date et une heure. Par exemple&nbsp;:
    
  </p>

<pre>brad.date [0]
</pre>

  <p>

    donne&nbsp;:
    
  </p>

<pre>Timestamp('2003-07-25 16:04:00')
</pre>

  <p>

    et on peut facilement accéder à chaque élément de ce tampon temporel&nbsp;:
    
  </p>
  
<pre>>>> brad.date [0].day
25
>>> brad.date [0].month
7
>>> brad.date [0].year
2003
>>> brad.date [0].hour
16
>>> brad.date [0].minute
4
>>> brad.date [0].second
0
</pre>

  <p>

    et à d'autres&nbsp;:

  </p>
  
<pre>>>> brad.date [0].month_name ()
'July'
>>> brad.date [0].day_name ()
'Friday'
>>> brad.date [0].day_of_week
4
>>> brad.date [0].day_of_year
206
>>> brad.date [0].week
30
>>> brad.date [0].weekofyear
30
>>> brad.date [0].days_in_month
31
</pre>

  <p>

    On peut alors facilement sélectionner des lignes correspondant à certains moments. Par exemple, la température du séjour pour toutes les lignes qui correspondent aux 23 du mois&nbsp;:
    
  </p>

<pre>>>> brad [brad.date.dt.day == 23].temp_lr
13590     24.1
13591     24.1
13592     24.1
13593     24.0
13594     24.0
          ... 
159136    21.8
159137    21.8
159138    21.7
159139    21.7
159140    21.6
</pre>

  <h4>Application aux dates dans le jeu de données <kbd>Brad</kbd></h4>

  <p>

  </p>

  <h2>Corrélation des températures&nbsp;?</h2>

  <p>

    intuitivement, il doit y avoir des corrélations...
    
  </p>
  
  <h3>Exploration visuelle</h3>

  <p>

    scatter plot
    
  </p>

  <h3>Approche quantitative</h3>

  <p>

  </p>
  


</div>

<!-- Default Statcounter code for on github
https://philippe-preux.github.io -->
<script type="text/javascript">
var sc_project=12923547; 
var sc_invisible=1; 
var sc_security="627600d4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/12923547/0/627600d4/1/"
alt="Web Analytics"
referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>
  <!-- End of Statcounter Code -->
  
</body>
</html>

